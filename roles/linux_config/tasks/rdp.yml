---
- name: Debian facts
  ansible.builtin.set_fact:
    linux_rdp_dependencies:
      - xorg
      - xrdp
      - task-xfce-desktop
  when: # ansible_os_family == Debian AND rdp != kali
    - ansible_os_family == "Debian"
    - not linux_config['kali'] # This should be false for non-kali hosts

- name: Kali facts
  ansible.builtin.set_fact:
    linux_rdp_dependencies:
      - kali-desktop-xfce
      - xorg
      - xrdp
  when: linux_config['kali'] # This should be true for kali hosts

- name: Apt install rdp dependencies
  ansible.builtin.include_tasks: packages.yml
  vars:
    packages: "{{ linux_rdp_dependencies }}"
  when: ansible_os_family == "Debian"

- name: Disable the kasmvnc service
  become: true
  ansible.builtin.service:
    name: kasmvnc@1.service
    daemon_reload: true
    enabled: false
    state: stopped

- name: Enable the xrdp.service
  become: true
  ansible.builtin.service:
    name: xrdp.service
    daemon_reload: true
    enabled: true
    state: started
